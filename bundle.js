(()=>{"use strict";window.util={removeNodeChild:t=>{for(;t.firstChild;)t.removeChild(t.firstChild)},debounce:t=>{let e;return(...o)=>{e&&window.clearTimeout(e),e=window.setTimeout((()=>{t(...o)}),500)}}},(()=>{const t=141,e=188,o=2,n="#b744d4",r=new window.fabric.Canvas("canvas",{width:t*o,height:e*o,backgroundColor:n});window.canvas={canvas:r}})(),(()=>{const t=document.querySelector(".form__control--background-color"),e=document.querySelector(".form__control--color-hex"),o=document.querySelector(".form__control--text-color"),n=document.querySelector(".form__control--text-color-hex"),r=(t,e)=>{window.canvas.canvas.backgroundColor=t.value,e.value=t.value,window.canvas.canvas.renderAll(),window.modifyText.updateDataWithImage()},i=(t,e)=>{window.text.text.set("fill",t.value),e.value=t.value,window.canvas.canvas.renderAll(),window.modifyText.updateData()};e.addEventListener("change",(()=>{r(e,t)})),t.addEventListener("change",(()=>{r(t,e)})),o.addEventListener("change",(()=>{i(o,n)})),n.addEventListener("change",(()=>{i(n,o)}))})(),(()=>{const t="Кликни — \nи двигай \nтекст!",e=10,o=110,n=2,r=new window.fabric.Text(t,{left:e*n,top:o*n,fill:"white",fontSize:36,lineHeight:1.16,fontFamily:"Roboto"});r.setControlsVisibility({mt:!1,mb:!1,ml:!1,mr:!1,tr:!1,tl:!1,br:!1,bl:!1,mtr:!1}),window.canvas.canvas.add(r),window.text={text:r}})(),(()=>{const t=document.querySelector(".export-buttons__control--with-text"),e=document.querySelector(".export-buttons__button--save-as-png"),o=document.querySelector(".preview__canvas");let n=!1;const r=()=>{window.canvas.canvas.getActiveObject()&&window.canvas.canvas.discardActiveObject().renderAll(),o.toBlob((t=>{window.saveAs(t,"preview.png")}))},i=()=>{window.text.text.set("fill","white"),window.canvas.canvas.requestRenderAll()};t.addEventListener("change",(()=>{n=t.checked})),e.addEventListener("click",(()=>{n?r():(window.text.text.set("fill","transparent"),window.canvas.canvas.requestRenderAll(),setTimeout(r,100),setTimeout(i,100)),window.robo.say("Изображение готово!")}))})(),(()=>{const t=document.querySelector(".form__control--file"),e=["gif","jpg","jpeg","png"];t.addEventListener("change",(function(t){const o=t.target.files[0],n=o.name.toLowerCase();if(e.some((t=>n.endsWith(t)))){const t=new FileReader;t.onload=function(t){const e=t.target.result;window.fabric.Image.fromURL(e,(function(t){const e=t.set({left:20,top:20,angle:"00"}).scale(.3);window.canvas.canvas.add(e).renderAll(),window.robo.say("Отличный выбор!")}))},t.readAsDataURL(o)}}))})(),(()=>{const t=document.querySelector(".export-buttons__button--clipboard"),e=document.querySelector(".form__control--export-html"),o=document.querySelector(".export-buttons__button--to-json"),n=(t,e)=>{navigator.clipboard.writeText(t).then((()=>{if("скопировано!"!==e.innerText){const t=e.innerText;e.innerText="скопировано!",setTimeout((()=>{e.innerText=t}),1500)}})).catch((t=>{window.robo.say("Something went wrong"+t)}))};t.addEventListener("click",(()=>{((t,e)=>{const o=t.value.trim();o&&n(o,e)})(e,t)})),o.addEventListener("click",(()=>{const t=(()=>{const t={html:window.clipboard.inputBannerHTML.textContent};return JSON.stringify(t)})();n(t,o)})),window.clipboard={inputBannerHTML:e}})(),(()=>{const t="Кликни — \nи двигай \nтекст!",e=10,o=110,n=141,r=188,i="https://www.avito.st/s/app/i/story-previews/story-51/preview@2x.jpg",a="https://avito.ru",s=2,c="#ffffff",d=document.querySelector(".form__control--banner-text"),l=document.querySelector(".form__control--link"),w=document.querySelector(".preview__html-container"),u=document.querySelector(".form__control--export-data-url");let v=a,p=t,x=e,m=o,f=i,g=c;const h=()=>{window.canvas.canvas.remove(window.text.text);const t=window.canvas.canvas.toDataURL({format:"png",quality:1});return window.canvas.canvas.add(window.text.text),t};let b=h();const _=()=>{window.clipboard.inputBannerHTML.textContent=(()=>{const t=p.replace(/\n/g,"<br>"),e=p.replace(/\n/g," ");return g=window.text.text.fill,`<a href="${v}" style="color: ${g}">\n  <div class="story-previewer-preview-2LCEH story-previewer-viewed-1bSIJ" style="position: relative; display: inline-block; overflow: hidden">\n    <img width="${n}" height="${r}" src="${f}" style="border-radius: 8px"\n        class="story-previewer-image-pkKji" alt="${e}">\n    <div class="story-previewer-title-eJkxt" style="position: absolute; top: ${m}px; left: ${x}px; font-size: 18px; line-height: 21px; width: 141px">${t}</div>\n  </div>\n</a>`})()};_();const y=t=>{u.textContent=(t=>{t&&(b=h()),g=window.text.text.fill;const e=p.replace(/\n/g,"<br>"),o=p.replace(/\n/g," ");return`<a href="${v}" style="color: ${g}">\n  <div class="story-previewer-preview-2LCEH story-previewer-viewed-1bSIJ" style="position: relative; display: inline-block; overflow: hidden">\n    <img width="${n}" height="${r}" src="${b}" style="border-radius: 8px"\n        class="story-previewer-image-pkKji" alt="${o}">\n    <div class="story-previewer-title-eJkxt" style="position: absolute; top: ${m}px; left: ${x}px; font-size: 18px; line-height: 21px; width: 141px">${e}</div>\n  </div>\n</a>`})(t)};y();const L=()=>{window.util.removeNodeChild(w),w.insertAdjacentHTML("afterbegin",u.textContent)};L();const S=()=>{_(),y(),L()},q=()=>{_(),y(!0),L()},C=window.util.debounce(S),T=window.util.debounce(q);window.canvas.canvas.on("mouse:move",(t=>{t.target&&("text"===t.target.type?(t.target.left>n*s?t.target.left=n*s-20:t.target.left<0&&(t.target.left=0),t.target.top>r*s?t.target.top=r*s-20:t.target.top<0&&(t.target.top=0),x=t.target.left/s,m=t.target.top/s,C()):"image"===t.target.type&&T())})),window.canvas.canvas.on("text:changed",(t=>{let e=t.target.text.split("\n");e.length>3&&(e=e.slice(0,3)),t.target.text=e.join("\n"),d.value=t.target.text,p=t.target.text,C()})),d.addEventListener("input",(()=>{let t=d.value.split("\n");t.length>3?(d.setCustomValidity("Для этого макета доступно только 3 строки"),window.robo.say("Только 3 строки..."),t=t.slice(0,3)):d.setCustomValidity(""),d.value=t.join("\n"),d.reportValidity(),window.canvas.canvas.remove(window.text.text),window.text.text.text=d.value,window.canvas.canvas.add(window.text.text),p=d.value,C()})),l.addEventListener("input",(()=>{v=l.value,C()})),window.modifyText={updateData:S,updateDataWithImage:q}})(),(()=>{const t=document.querySelector(".promo__robo-text"),e=document.querySelector(".robo__flashes"),o=document.querySelector(".preview__info-btn"),n=o=>{t.textContent=o,t.classList.remove("promo__robo-text--animation"),e.classList.remove("robo__flashes--animation"),t.offsetWidth,t.classList.add("promo__robo-text--animation"),e.classList.add("robo__flashes--animation")};setTimeout((()=>{n("создадим баннер!")}),4e3),o.addEventListener("click",(()=>{n("Текст можно двигать!")})),window.robo={say:n}})(),(()=>{const t=document.querySelector(".export-buttons__show-config--link"),e=document.querySelector(".export-buttons__show-config--data-uri"),o=document.querySelector(".export-buttons__textarea-item--export-html"),n=document.querySelector(".export-buttons__textarea-item--export-data-url"),r=(t,e,o,n)=>{const r=t.classList.contains("export-buttons__textarea-item--hidden"),i=o.classList.contains("export-buttons__show-config--hidden");r&&i&&(t.classList.remove("export-buttons__textarea-item--hidden"),e.classList.add("export-buttons__textarea-item--hidden"),o.classList.remove("export-buttons__show-config--hidden"),n.classList.add("export-buttons__show-config--hidden"))};t.addEventListener("click",(()=>{r(o,n,t,e)})),e.addEventListener("click",(()=>{r(n,o,e,t)}))})()})();